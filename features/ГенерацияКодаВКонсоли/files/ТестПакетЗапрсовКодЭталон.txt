Функция ПолучитьДанные(КалендарьРФ, ДатаОкончания, ДатаНачала, Подразделение, Организация)
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц();
	Запрос.УстановитьПараметр("КалендарьРФ", КалендарьРФ);
	Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
	Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
	Запрос.УстановитьПараметр("Подразделение", Подразделение);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	Сотрудники.Ссылка КАК Сотрудник,
	|	&ДатаНачала КАК ДатаНачала,
	|	&ДатаОкончания КАК ДатаОкончания
	|ПОМЕСТИТЬ ВТФильтрКадровойИстории
	|ИЗ
	|	Справочник.Сотрудники КАК Сотрудники";
	Запрос.Выполнить();
	Измерения = Новый Массив();
	СоответствиеИзмерений = Новый Соответствие();
	Измерения.Добавить("ДатаОкончания");
	СоответствиеИзмерений.Вставить("ДатаОкончания", "ДатаОкончания");
	Измерения.Добавить("ДатаНачала");
	СоответствиеИзмерений.Вставить("ДатаНачала", "ДатаНачала");
	Измерения.Добавить("Сотрудник");
	СоответствиеИзмерений.Вставить("Сотрудник", "Сотрудник");
	ОписаниеВТФильтр = ЗарплатаКадрыПериодическиеРегистры.ОписаниеФильтраДляСоздатьВТИмяРегистраПоВременнойТаблице(
		"ВТФильтрКадровойИстории",
		Измерения);
	ОписаниеВТФильтр.СоответствиеИзмеренийРегистраИзмерениямФильтра = СоответствиеИзмерений;
	ПараметрыПостроения = ЗарплатаКадрыПериодическиеРегистры.ПараметрыПостроенияДляСоздатьВТИмяРегистра();

	ПараметрыПостроения.ИндексироватьПо = Новый Массив;



	ПараметрыПостроения.ВключатьЗаписиНаНачалоПериода = Истина;
	ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "Подразделение", "В ИЕРАРХИИ", Подразделение);
	ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "Организация", "=", Организация);


	ПараметрыПостроения.ОтборыЗаписейНаНачалоПериода = Новый Массив();
	ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.ОтборыЗаписейНаНачалоПериода, "Подразделение", "В ИЕРАРХИИ", Подразделение);
	ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.ОтборыЗаписейНаНачалоПериода, "Организация", "=", Организация);


	ЗарплатаКадрыПериодическиеРегистры.СоздатьВТИмяРегистраПериоды(
		"КадроваяИсторияСотрудников",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ОписаниеВТФильтр,
		ПараметрыПостроения,
		"ВТКадроваяИсторияСотрудниковИнтервалы");

	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	КадроваяИсторияСотрудниковИнтервалы.Сотрудник КАК Сотрудник,
	|	КадроваяИсторияСотрудниковИнтервалы.Организация КАК Организация,
	|	КадроваяИсторияСотрудниковИнтервалы.Подразделение КАК Подразделение,
	|	КадроваяИсторияСотрудниковИнтервалы.Должность КАК Должность,
	|	КадроваяИсторияСотрудниковИнтервалы.ДолжностьПоШтатномуРасписанию КАК ДолжностьПоШтатномуРасписанию,
	|	КадроваяИсторияСотрудниковИнтервалы.НачалоПериода КАК НачалоПериода,
	|	КадроваяИсторияСотрудниковИнтервалы.КонецПериода КАК КонецПериода,
	|	КадроваяИсторияСотрудниковИнтервалы.ГоловнаяОрганизация КАК ГоловнаяОрганизация,
	|	КадроваяИсторияСотрудниковИнтервалы.КоличествоСтавок КАК КоличествоСтавок,
	|	КадроваяИсторияСотрудниковИнтервалы.ВидСобытия КАК ВидСобытия
	|ПОМЕСТИТЬ ВТИнтервалыКадровойИстории
	|ИЗ
	|	ВТКадроваяИсторияСотрудниковИнтервалы КАК КадроваяИсторияСотрудниковИнтервалы
	|ГДЕ
	|	КадроваяИсторияСотрудниковИнтервалы.ВидСобытия <> ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Увольнение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ИнтервалыКадровойИстории.Сотрудник КАК Сотрудник,
	|	&ДатаНачала КАК ДатаНачала,
	|	&ДатаОкончания КАК ДатаОкончания
	|ПОМЕСТИТЬ ВТСотрудники
	|ИЗ
	|	ВТИнтервалыКадровойИстории КАК ИнтервалыКадровойИстории
	|ГДЕ
	|	ИнтервалыКадровойИстории.ВидСобытия <> ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Увольнение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПроизводственногоКалендаряПомесячно.Год КАК Год,
	|	СУММА(ДанныеПроизводственногоКалендаряПомесячно.РабочихДней) / 12 КАК РабочихДней,
	|	СУММА(ДанныеПроизводственногоКалендаряПомесячно.РабочихЧасовДлительностьНедели40Часов) / 12 КАК РабочихЧасов
	|ПОМЕСТИТЬ ВТДанныеКалендаря
	|ИЗ
	|	РегистрСведений.ДанныеПроизводственногоКалендаряПомесячно КАК ДанныеПроизводственногоКалендаряПомесячно
	|ГДЕ
	|	ДанныеПроизводственногоКалендаряПомесячно.ПроизводственныйКалендарь = &КалендарьРФ
	|	И ДанныеПроизводственногоКалендаряПомесячно.Год МЕЖДУ ГОД(&ДатаНачала) И ГОД(&ДатаОкончания)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПроизводственногоКалендаряПомесячно.Год";
	Запрос.Выполнить();
	Измерения = Новый Массив();
	СоответствиеИзмерений = Новый Соответствие();
	Измерения.Добавить("ДатаОкончания");
	СоответствиеИзмерений.Вставить("ДатаОкончания", "ДатаОкончания");
	Измерения.Добавить("ДатаНачала");
	СоответствиеИзмерений.Вставить("ДатаНачала", "ДатаНачала");
	Измерения.Добавить("Сотрудник");
	СоответствиеИзмерений.Вставить("Сотрудник", "Сотрудник");
	ОписаниеВТФильтр = ЗарплатаКадрыПериодическиеРегистры.ОписаниеФильтраДляСоздатьВТИмяРегистраПоВременнойТаблице(
		"ВТСотрудники",
		Измерения);
	ОписаниеВТФильтр.СоответствиеИзмеренийРегистраИзмерениямФильтра = СоответствиеИзмерений;
	ПараметрыПостроения = ЗарплатаКадрыПериодическиеРегистры.ПараметрыПостроенияДляСоздатьВТИмяРегистра();

	ПараметрыПостроения.ИндексироватьПо = Новый Массив;



	ПараметрыПостроения.ВключатьЗаписиНаНачалоПериода = Истина;
	ПараметрыПостроения.ОтборыЗаписейНаНачалоПериода = Новый Массив();
	ЗарплатаКадрыПериодическиеРегистры.СоздатьВТИмяРегистра(
		"КадроваяИсторияСотрудников",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ОписаниеВТФильтр,
		ПараметрыПостроения,
		"ВТКадроваяИсторияСотрудниковЗаписи");

	Измерения = Новый Массив();
	СоответствиеИзмерений = Новый Соответствие();
	Измерения.Добавить("ДатаОкончания");
	СоответствиеИзмерений.Вставить("ДатаОкончания", "ДатаОкончания");
	Измерения.Добавить("ДатаНачала");
	СоответствиеИзмерений.Вставить("ДатаНачала", "ДатаНачала");
	Измерения.Добавить("Сотрудник");
	СоответствиеИзмерений.Вставить("Сотрудник", "Сотрудник");
	ОписаниеВТФильтр = ЗарплатаКадрыПериодическиеРегистры.ОписаниеФильтраДляСоздатьВТИмяРегистраПоВременнойТаблице(
		"ВТСотрудники",
		Измерения);
	ОписаниеВТФильтр.СоответствиеИзмеренийРегистраИзмерениямФильтра = СоответствиеИзмерений;
	ПараметрыПостроения = ЗарплатаКадрыПериодическиеРегистры.ПараметрыПостроенияДляСоздатьВТИмяРегистра();

	ПараметрыПостроения.ИндексироватьПо = Новый Массив;




	ЗарплатаКадрыПериодическиеРегистры.СоздатьВТИмяРегистра(
		"ПлановыйФОТИтоги",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ОписаниеВТФильтр,
		ПараметрыПостроения,
		"ВТПлановыйФОТИтогиЗаписи");

	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	КадроваяИсторияСотрудниковЗаписи.Сотрудник КАК Сотрудник,
	|	ВЫБОР
	|		КОГДА КадроваяИсторияСотрудниковЗаписи.ПериодЗаписи < &ДатаНачала
	|			ТОГДА &ДатаНачала
	|		ИНАЧЕ КадроваяИсторияСотрудниковЗаписи.ПериодЗаписи
	|	КОНЕЦ КАК ПериодЗаписи,
	|	КадроваяИсторияСотрудниковЗаписи.ДолжностьПоШтатномуРасписанию КАК ДолжностьПоШтатномуРасписанию
	|ПОМЕСТИТЬ ВТПериодыИзмененияДанных
	|ИЗ
	|	ВТКадроваяИсторияСотрудниковЗаписи КАК КадроваяИсторияСотрудниковЗаписи
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПлановыйФОТИтогиЗаписи.Сотрудник,
	|	ПлановыйФОТИтогиЗаписи.ПериодЗаписи,
	|	ВТИнтервалыКадровойИстории.ДолжностьПоШтатномуРасписанию
	|ИЗ
	|	ВТПлановыйФОТИтогиЗаписи КАК ПлановыйФОТИтогиЗаписи
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТИнтервалыКадровойИстории КАК ВТИнтервалыКадровойИстории
	|		ПО ПлановыйФОТИтогиЗаписи.Сотрудник = ВТИнтервалыКадровойИстории.Сотрудник
	|			И (ПлановыйФОТИтогиЗаписи.ПериодЗаписи МЕЖДУ ВТИнтервалыКадровойИстории.НачалоПериода И ВТИнтервалыКадровойИстории.КонецПериода)
	|ГДЕ
	|	ВТИнтервалыКадровойИстории.ВидСобытия <> ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Увольнение)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВТСотрудники.Сотрудник,
	|	ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ВТСотрудники.ДатаНачала, ГОД), ГОД, ВТДанныеКалендаря.Год - ГОД(ВТСотрудники.ДатаНачала)),
	|	ВТИнтервалыКадровойИстории.ДолжностьПоШтатномуРасписанию
	|ИЗ
	|	ВТСотрудники КАК ВТСотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДанныеКалендаря КАК ВТДанныеКалендаря
	|		ПО (ГОД(ВТСотрудники.ДатаНачала) < ВТДанныеКалендаря.Год)
	|			И (ГОД(ВТСотрудники.ДатаОкончания) >= ВТДанныеКалендаря.Год)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТИнтервалыКадровойИстории КАК ВТИнтервалыКадровойИстории
	|		ПО ВТСотрудники.Сотрудник = ВТИнтервалыКадровойИстории.Сотрудник
	|			И (ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ВТСотрудники.ДатаНачала, ГОД), ГОД, ВТДанныеКалендаря.Год - ГОД(ВТСотрудники.ДатаНачала)) МЕЖДУ ВТИнтервалыКадровойИстории.НачалоПериода И ВТИнтервалыКадровойИстории.КонецПериода)
	|ГДЕ
	|	ВТИнтервалыКадровойИстории.ВидСобытия <> ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Увольнение)";
	Запрос.Выполнить();
	Измерения = Новый Массив();
	СоответствиеИзмерений = Новый Соответствие();
	СоответствиеИзмерений.Вставить("Период", "ПериодЗаписи");
	Измерения.Добавить("Сотрудник");
	СоответствиеИзмерений.Вставить("Сотрудник", "Сотрудник");

	ОписаниеВТФильтр = ЗарплатаКадрыПериодическиеРегистры.ОписаниеФильтраДляСоздатьВТИмяРегистраПоВременнойТаблице(
		"ВТПериодыИзмененияДанных",
		Измерения);
	ОписаниеВТФильтр.СоответствиеИзмеренийРегистраИзмерениямФильтра = СоответствиеИзмерений;
	ПараметрыПостроения = ЗарплатаКадрыПериодическиеРегистры.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();

	ПараметрыПостроения.ИндексироватьПо = Новый Массив;





	ЗарплатаКадрыПериодическиеРегистры.СоздатьВТИмяРегистраСрезПоследних(
		"ПлановыйФОТИтоги",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ОписаниеВТФильтр,
		ПараметрыПостроения,
		"ВТПлановыйФОТИтогиСрезПоследних");

	Поля = Новый Массив();
	Поля.Добавить("СОТРУДНИК");
	Поля.Добавить("ДАТАПРИЕМА");
	Поля.Добавить("ТАБЕЛЬНЫЙНОМЕР");
	ИмяВТФильтр = "ВТСотрудники";
	ФормироватьСПериодичностьДень = Истина;
	ИменаПолейФильтра = "Сотрудник,ДатаОкончания";
	ОписаниеФильтра = КадровыйУчет.ОписательВременныхТаблицДляСоздатьВТКадровыеДанныеСотрудников(
		Запрос.МенеджерВременныхТаблиц,
		ИмяВТФильтр,
		ИменаПолейФильтра);
	ОписаниеФильтра.ИмяВТКадровыеДанныеСотрудников = "ВТДанныеСотрудников";
	ТолькоРазрешенные = Истина;
	КадровыйУчет.СоздатьВТКадровыеДанныеСотрудников(
		ОписаниеФильтра,
		ТолькоРазрешенные,
		Поля,,
		ФормироватьСПериодичностьДень);

	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ВТПериодыИзмененияДанных.Сотрудник КАК Сотрудник,
	|	ДанныеСотрудников.ТабельныйНомер КАК ТабельныйНомер,
	|	ДанныеСотрудников.ДатаПриема КАК ДатаПриема,
	|	ВТПериодыИзмененияДанных.ПериодЗаписи КАК ПериодЗаписи,
	|	ВТИнтервалыКадровойИстории.ДолжностьПоШтатномуРасписанию КАК ПозицияПШР,
	|	ВТИнтервалыКадровойИстории.ГоловнаяОрганизация КАК ГоловнаяОрганизация,
	|	ВТИнтервалыКадровойИстории.Подразделение КАК Подразделение,
	|	ПлановыйФОТИтогиСрезПоследних.ТарифнаяСтавка КАК ОкладТариф,
	|	ВЫБОР
	|		КОГДА ПлановыйФОТИтогиСрезПоследних.ВидТарифнойСтавки = ЗНАЧЕНИЕ(Перечисление.ВидыТарифныхСтавок.ЧасоваяТарифнаяСтавка)
	|			ТОГДА ПлановыйФОТИтогиСрезПоследних.ТарифнаяСтавка * ВТДанныеКалендаря.РабочихЧасов
	|		КОГДА ПлановыйФОТИтогиСрезПоследних.ВидТарифнойСтавки = ЗНАЧЕНИЕ(Перечисление.ВидыТарифныхСтавок.ДневнаяТарифнаяСтавка)
	|			ТОГДА ПлановыйФОТИтогиСрезПоследних.ТарифнаяСтавка * ВТДанныеКалендаря.РабочихДней
	|		ИНАЧЕ ПлановыйФОТИтогиСрезПоследних.ТарифнаяСтавка
	|	КОНЕЦ КАК МесячнаяТарифнаяСтавка,
	|	ВТИнтервалыКадровойИстории.КоличествоСтавок КАК Процент,
	|	"RUB" КАК Валюта
	|ИЗ
	|	ВТПериодыИзмененияДанных КАК ВТПериодыИзмененияДанных
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТИнтервалыКадровойИстории КАК ВТИнтервалыКадровойИстории
	|		ПО ВТПериодыИзмененияДанных.Сотрудник = ВТИнтервалыКадровойИстории.Сотрудник
	|			И (ВТПериодыИзмененияДанных.ПериодЗаписи МЕЖДУ ВТИнтервалыКадровойИстории.НачалоПериода И ВТИнтервалыКадровойИстории.КонецПериода)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК ВТСотрудники
	|		ПО ВТПериодыИзмененияДанных.Сотрудник = ВТСотрудники.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыйФОТИтогиСрезПоследних КАК ПлановыйФОТИтогиСрезПоследних
	|		ПО ВТПериодыИзмененияДанных.Сотрудник = ПлановыйФОТИтогиСрезПоследних.Сотрудник
	|			И ВТПериодыИзмененияДанных.ПериодЗаписи = ПлановыйФОТИтогиСрезПоследних.Период
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеКалендаря КАК ВТДанныеКалендаря
	|		ПО (ГОД(ВТПериодыИзмененияДанных.ПериодЗаписи) = ВТДанныеКалендаря.Год)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеСотрудников КАК ДанныеСотрудников
	|		ПО ВТПериодыИзмененияДанных.Сотрудник = ДанныеСотрудников.Сотрудник
	|
	|УПОРЯДОЧИТЬ ПО
	|	Сотрудник,
	|	ПериодЗаписи";
	Возврат Запрос.Выполнить();
КонецФункции
