Функция ПолучитьДанные(Нач, Кон)
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц();
	Запрос.УстановитьПараметр("Нач", Нач);
	Запрос.УстановитьПараметр("Кон", Кон);

	СКД = Новый СхемаКомпоновкиДанных();
	Источник = СКД.ИсточникиДанных.Добавить();
	Источник.Имя = "Источник";
	Источник.ТипИсточникаДанных = "local";
	НаборСКД = СКД.НаборыДанных.Добавить(Тип("НаборДанныхЗапросСхемыКомпоновкиДанных"));
	НаборСКД.ИсточникДанных = "Источник";
	НаборСКД.Имя = "Данные";
	НаборСКД.АвтоЗаполнениеДоступныхПолей = Истина;
	НаборСКД.Запрос = 
	"ВЫБРАТЬ
	|	Обороты.Период КАК Период,
	|	Обороты.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	Обороты.СуммаДоходаОборот КАК СуммаДоходаОборот,
	|	Обороты.СуммаДоходаОборот КАК СуммаДоходаОборот1,
	|	Обороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Обороты.ГоловнаяОрганизация КАК ГоловнаяОрганизация
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ.Обороты(
	|			&Нач,
	|			&Кон,
	|			ДЕНЬ,
	|			ФизическоеЛицо.Пол = ЗНАЧЕНИЕ(Перечисление.ПолФизическогоЛица.Мужской)
	|				ИЛИ ИсточникДоходаЗаПределамиРФ) КАК Обороты";

	ПараметрСКД = СКД.Параметры.Добавить();
	ПараметрСКД.Использование = ИспользованиеПараметраКомпоновкиДанных.Всегда;
	ПараметрСКД.Имя = "Кон";
	ПараметрСКД.ДоступенСписокЗначений = Истина;
	ПараметрСКД.Значение = Кон;

	ПараметрСКД = СКД.Параметры.Добавить();
	ПараметрСКД.Использование = ИспользованиеПараметраКомпоновкиДанных.Всегда;
	ПараметрСКД.Имя = "Нач";
	ПараметрСКД.ДоступенСписокЗначений = Истина;
	ПараметрСКД.Значение = Нач;

	НастройкиСКД = СКД.ВариантыНастроек.Добавить().Настройки;
	Группа = НастройкиСКД.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
	ДетальныеЗаписи = Группа.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));

	ПолеСКД = Группа.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("ИСТОЧНИКДОХОДАЗАПРЕДЕЛАМИРФ");
	ПолеСКД.Использование = Истина;
	
	ПолеСКД = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("ИСТОЧНИКДОХОДАЗАПРЕДЕЛАМИРФ");
	ПолеСКД.Использование = Истина;
	ВычисляемоеПоле = СКД.ВычисляемыеПоля.Добавить();
	ВычисляемоеПоле.Заголовок = "СуммаДоходаНарастающийИтог";
	ВычисляемоеПоле.ПутьКДанным = "СуммаДоходаНарастающийИтог";
	ВычисляемоеПоле.Выражение = "ВычислитьВыражение(""Сумма(СуммаДоходаОборот)"", , ""Группировка"", ""Первая"", ""Текущая"", ""Период"")";
	ВычисляемоеПоле.ТипЗначения = Новый ОписаниеТипов("Число");
	ПолеСКД = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("СуммаДоходаНарастающийИтог");
	ПолеСКД.Использование = Истина;
	ПолеСКД = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("СуммаДоходаОборот");
	ПолеСКД.Использование = Истина;
	ПолеСКД = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("СуммаДоходаОборот");
	ПолеСКД.Использование = Истина;
	ПолеСКД = Группа.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("ФИЗИЧЕСКОЕЛИЦО");
	ПолеСКД.Использование = Истина;
	
	ПолеСКД = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("ФИЗИЧЕСКОЕЛИЦО");
	ПолеСКД.Использование = Истина;
	ПолеСКД = Группа.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("ГОЛОВНАЯОРГАНИЗАЦИЯ");
	ПолеСКД.Использование = Истина;
	
	ПолеСКД = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	ПолеСКД.Поле = Новый ПолеКомпоновкиДанных("ГОЛОВНАЯОРГАНИЗАЦИЯ");
	ПолеСКД.Использование = Истина;

	ПараметрСКД = НастройкиСКД.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Кон"));
	Если ПараметрСКД <> Неопределено Тогда
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение = Кон;
	КонецЕсли;
	ПараметрСКД = НастройкиСКД.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Нач"));
	Если ПараметрСКД <> Неопределено Тогда
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение = Нач;
	КонецЕсли;

	Поле = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	Поле.Поле = Новый ПолеКомпоновкиДанных("СистемныеПоля.Уровень");
	Поле.Использование = Истина;
	
	Поле = ДетальныеЗаписи.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	Поле.Поле = Новый ПолеКомпоновкиДанных("Период");
	Поле.Использование = Истина;
	
	ЭлементПорядка = ДетальныеЗаписи.Порядок.Элементы.Добавить(Тип("ЭлементПорядкаКомпоновкиДанных"));
	ЭлементПорядка.Использование = Истина;
	ЭлементПорядка.Поле = Новый ПолеКомпоновкиДанных("Период");
	
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновкиДанных = КомпоновщикМакета.Выполнить(СКД, НастройкиСКД, , ,
		Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
		
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновки.Инициализировать(МакетКомпоновкиДанных, , , , , Запрос.МенеджерВременныхТаблиц);
	НарастающийИтог = Новый ТаблицаЗначений;
		
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений;
	ПроцессорВывода.УстановитьОбъект(НарастающийИтог);
		
	ПроцессорВывода.Вывести(ПроцессорКомпоновки);

	ЗапросПомещенияВВТ = Новый Запрос();
	ЗапросПомещенияВВТ.МенеджерВременныхТаблиц = Запрос.МенеджерВременныхТаблиц;
	ЗапросПомещенияВВТ.УстановитьПараметр("Таблица", НарастающийИтог.Скопировать(Новый Структура("СистемныеПоляУровень", 2)));
	ЗапросПомещенияВВТ.Текст = 
	"ВЫБРАТЬ
	|	Таблица.ИСТОЧНИКДОХОДАЗАПРЕДЕЛАМИРФ КАК ИСТОЧНИКДОХОДАЗАПРЕДЕЛАМИРФ,
	|	Таблица.СУММАДОХОДАНАРАСТАЮЩИЙИТОГ КАК СУММАДОХОДАНАРАСТАЮЩИЙИТОГ,
	|	Таблица.СУММАДОХОДАОБОРОТ КАК СУММАДОХОДАОБОРОТ,
	|	Таблица.ПЕРИОД КАК ПЕРИОД,
	|	Таблица.ФИЗИЧЕСКОЕЛИЦО КАК ФИЗИЧЕСКОЕЛИЦО,
	|	Таблица.ГОЛОВНАЯОРГАНИЗАЦИЯ КАК ГОЛОВНАЯОРГАНИЗАЦИЯ
	|ПОМЕСТИТЬ ВТСведенияОДоходахНДФЛНарастазщиеИтоги
	|ИЗ
	|	&Таблица КАК Таблица";
	ЗапросПомещенияВВТ.Выполнить();

	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СведенияОДоходахНДФЛНарастазщиеИтоги.ГоловнаяОрганизация КАК ГоловнаяОрганизация,
	|	СведенияОДоходахНДФЛНарастазщиеИтоги.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СведенияОДоходахНДФЛНарастазщиеИтоги.Период КАК Период,
	|	СведенияОДоходахНДФЛНарастазщиеИтоги.СуммаДоходаОборот КАК СуммаДоходаОборот,
	|	СведенияОДоходахНДФЛНарастазщиеИтоги.СуммаДоходаНарастающийИтог КАК СуммаДоходаНарастающийИтог
	|ИЗ
	|	ВТСведенияОДоходахНДФЛНарастазщиеИтоги КАК СведенияОДоходахНДФЛНарастазщиеИтоги
	|
	|УПОРЯДОЧИТЬ ПО
	|	ГоловнаяОрганизация,
	|	ФизическоеЛицо,
	|	Период";
	Возврат Запрос.Выполнить();
КонецФункции
